
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>类型关联 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="hooks.html" />
    
    
    <link rel="prev" href="usage.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="getting-started.html">
            
                <a href="getting-started.html">
            
                    
                    安装/入门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="usage.html">
            
                <a href="usage.html">
            
                    
                    快速上手
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4" data-path="associations.html">
            
                <a href="associations.html">
            
                    
                    类型关联
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="hooks.html">
            
                <a href="hooks.html">
            
                    
                    生命周期Hook
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="instances.html">
            
                <a href="instances.html">
            
                    
                    实例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="legacy.html">
            
                <a href="legacy.html">
            
                    
                    使用遗留表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="migrations.html">
            
                <a href="migrations.html">
            
                    
                    迁移
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    模型
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="models/definition.html">
            
                <a href="models/definition.html">
            
                    
                    模型定义
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="models/usage.html">
            
                <a href="models/usage.html">
            
                    
                    模型使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="querying.html">
            
                <a href="querying.html">
            
                    
                    查询
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="raw-queries.html">
            
                <a href="raw-queries.html">
            
                    
                    原始查询
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="scopes.html">
            
                <a href="scopes.html">
            
                    
                    作用域
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="transactions.html">
            
                <a href="transactions.html">
            
                    
                    事务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" >
            
                <span>
            
                    
                    升级更新
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="upgrade-to-v4.html">
            
                <a href="upgrade-to-v4.html">
            
                    
                    升级到v4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="upgrade-to-v5.html">
            
                <a href="upgrade-to-v5.html">
            
                    
                    升级到v4
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >类型关联</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="associations---&#x5173;&#x8054;">Associations - &#x5173;&#x8054;</h1>
<p>&#x672C;&#x90E8;&#x5206;&#x63CF;&#x8FF0;&#x4E86; Sequelize &#x4E2D;&#x7684;&#x5404;&#x79CD;&#x5173;&#x8054;&#x7C7B;&#x578B;&#x3002; Sequelize &#x4E2D;&#x6709;&#x56DB;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x5173;&#x8054;</p>
<ol>
<li>BelongsTo</li>
<li>HasOne</li>
<li>HasMany</li>
<li>BelongsToMany</li>
</ol>
<h2 id="&#x57FA;&#x672C;&#x6982;&#x5FF5;">&#x57FA;&#x672C;&#x6982;&#x5FF5;</h2>
<h3 id="source--target">Source &amp; Target</h3>
<p>&#x6211;&#x4EEC;&#x9996;&#x5148;&#x4ECE;&#x4E00;&#x4E2A;&#x57FA;&#x672C;&#x6982;&#x5FF5;&#x5F00;&#x59CB;&#xFF0C;&#x4F60;&#x5C06;&#x4F1A;&#x5728;&#x5927;&#x591A;&#x6570;&#x5173;&#x8054;&#x4E2D;&#x4F7F;&#x7528; <strong>source</strong> &#x548C; <strong>target</strong> &#x6A21;&#x578B;&#x3002; &#x5047;&#x8BBE;&#x60A8;&#x6B63;&#x8BD5;&#x56FE;&#x5728;&#x4E24;&#x4E2A;&#x6A21;&#x578B;&#x4E4B;&#x95F4;&#x6DFB;&#x52A0;&#x5173;&#x8054;&#x3002; &#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5728; <code>User</code> &#x548C; <code>Project</code> &#x4E4B;&#x95F4;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A; <code>hasOne</code> &#x5173;&#x8054;&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> User = sequelize.define(<span class="hljs-string">&apos;User&apos;</span>, {
  name: Sequelize.STRING,
  email: Sequelize.STRING
});

<span class="hljs-keyword">const</span> Project = sequelize.define(<span class="hljs-string">&apos;Project&apos;</span>, {
  name: Sequelize.STRING
});

User.hasOne(Project);
</code></pre>
<p><code>User</code> &#x6A21;&#x578B;&#xFF08;&#x51FD;&#x6570;&#x88AB;&#x8C03;&#x7528;&#x7684;&#x6A21;&#x578B;&#xFF09;&#x662F; <strong>source</strong> &#x3002; <code>Project</code> &#x6A21;&#x578B;&#xFF08;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7684;&#x6A21;&#x578B;&#xFF09;&#x662F; <strong>target</strong> &#x3002;</p>
<h3 id="&#x5916;&#x952E;">&#x5916;&#x952E;</h3>
<p>&#x5F53;&#x60A8;&#x5728;&#x6A21;&#x578B;&#x4E2D;&#x521B;&#x5EFA;&#x5173;&#x8054;&#x65F6;&#xFF0C;&#x4F1A;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x5E26;&#x7EA6;&#x675F;&#x7684;&#x5916;&#x952E;&#x5F15;&#x7528;&#x3002; &#x4E0B;&#x9762;&#x662F;&#x8BBE;&#x7F6E;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> Task = sequelize.define(<span class="hljs-string">&apos;task&apos;</span>, { title: Sequelize.STRING });
<span class="hljs-keyword">const</span> User = sequelize.define(<span class="hljs-string">&apos;user&apos;</span>, { username: Sequelize.STRING });

User.hasMany(Task); <span class="hljs-comment">// &#x5C06;&#x4F1A;&#x6DFB;&#x52A0; userId &#x5230; Task &#x6A21;&#x578B;</span>
Task.belongsTo(User); <span class="hljs-comment">// &#x4E5F;&#x5C06;&#x4F1A;&#x6DFB;&#x52A0; userId &#x5230; Task &#x6A21;&#x578B;</span>
</code></pre>
<p>&#x5C06;&#x751F;&#x6210;&#x4EE5;&#x4E0B;SQL&#xFF1A;</p>
<pre><code class="lang-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">&quot;users&quot;</span> (
  <span class="hljs-string">&quot;id&quot;</span> <span class="hljs-built_in">SERIAL</span>,
  <span class="hljs-string">&quot;username&quot;</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">255</span>),
  <span class="hljs-string">&quot;createdAt&quot;</span> <span class="hljs-keyword">TIMESTAMP</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TIME</span> ZONE <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">&quot;updatedAt&quot;</span> <span class="hljs-keyword">TIMESTAMP</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TIME</span> ZONE <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">&quot;id&quot;</span>)
);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">&quot;tasks&quot;</span> (
  <span class="hljs-string">&quot;id&quot;</span> <span class="hljs-built_in">SERIAL</span>,
  <span class="hljs-string">&quot;title&quot;</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">255</span>),
  <span class="hljs-string">&quot;createdAt&quot;</span> <span class="hljs-keyword">TIMESTAMP</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TIME</span> ZONE <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">&quot;updatedAt&quot;</span> <span class="hljs-keyword">TIMESTAMP</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TIME</span> ZONE <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">&quot;userId&quot;</span> <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-string">&quot;users&quot;</span> (<span class="hljs-string">&quot;id&quot;</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span>
  <span class="hljs-keyword">SET</span>
    <span class="hljs-literal">NULL</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">CASCADE</span>,
    PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">&quot;id&quot;</span>)
);
</code></pre>
<p><code>tasks</code> &#x548C; <code>users</code> &#x6A21;&#x578B;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x901A;&#x8FC7;&#x5728; <code>tasks</code> &#x8868;&#x4E0A;&#x6CE8;&#x5165; <code>userId</code> &#x5916;&#x952E;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x6807;&#x8BB0;&#x4E3A;&#x5BF9; <code>users</code> &#x8868;&#x7684;&#x5F15;&#x7528;&#x3002; &#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x5F15;&#x7528;&#x7684;&#x7528;&#x6237;&#x88AB;&#x5220;&#x9664;&#xFF0C;<code>userId</code> &#x5C06;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A; <code>NULL</code>&#xFF0C;&#x5982;&#x679C;&#x66F4;&#x65B0;&#x4E86; <code>userId</code>&#xFF0C;&#x5219;&#x66F4;&#x65B0; <code>userId</code>&#x3002; &#x8FD9;&#x4E9B;&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5C06; <code>onUpdate</code> &#x548C; <code>onDelete</code> &#x9009;&#x9879;&#x4F20;&#x9012;&#x7ED9;&#x5173;&#x8054;&#x8C03;&#x7528;&#x6765;&#x8986;&#x76D6;&#x3002; &#x9A8C;&#x8BC1;&#x9009;&#x9879;&#x662F; <code>RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL</code>&#x3002;</p>
<p>&#x5BF9;&#x4E8E; 1:1 &#x548C; 1:m &#x5173;&#x8054;&#xFF0C;&#x9ED8;&#x8BA4;&#x9009;&#x9879;&#x662F; <code>SET NULL</code> &#x7528;&#x4E8E;&#x5220;&#x9664;&#xFF0C;<code>CASCADE</code> &#x7528;&#x4E8E;&#x66F4;&#x65B0;&#x3002; &#x5BF9;&#x4E8E; n:m&#xFF0C;&#x4E24;&#x8005;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x662F; <code>CASCADE</code>&#x3002; &#x8FD9;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x4ECE; n:m &#x5173;&#x8054;&#x7684;&#x4E00;&#x4FA7;&#x5220;&#x9664;&#x6216;&#x66F4;&#x65B0;&#x4E00;&#x884C;&#xFF0C;&#x5219;&#x5F15;&#x7528;&#x8BE5;&#x884C;&#x7684;&#x8FDE;&#x63A5;&#x8868;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x884C;&#x4E5F;&#x5C06;&#x88AB;&#x5220;&#x9664;&#x6216;&#x66F4;&#x65B0;&#x3002;</p>
<h4 id="&#x4E0B;&#x5212;&#x7EBF;&#x53C2;&#x6570;">&#x4E0B;&#x5212;&#x7EBF;&#x53C2;&#x6570;</h4>
<p>Sequelize &#x5141;&#x8BB8;&#x4E3A;&#x6A21;&#x578B;&#x8BBE;&#x7F6E; <code>underscored</code> &#x9009;&#x9879;&#x3002; &#x5F53; <code>true</code> &#x65F6;&#xFF0C;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x4F1A;&#x5C06;&#x6240;&#x6709;&#x5C5E;&#x6027;&#x7684; <code>field</code> &#x9009;&#x9879;&#x8BBE;&#x7F6E;&#x4E3A;&#x5176;&#x540D;&#x79F0;&#x7684;&#x4E0B;&#x5212;&#x7EBF;&#x7248;&#x672C;&#x3002; &#x8FD9;&#x4E5F;&#x9002;&#x7528;&#x4E8E;&#x7531;&#x5173;&#x8054;&#x751F;&#x6210;&#x7684;&#x5916;&#x952E;&#x3002;</p>
<p>&#x8BA9;&#x6211;&#x4EEC;&#x4FEE;&#x6539;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x6765;&#x4F7F;&#x7528; <code>underscored</code> &#x9009;&#x9879;&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> Task = sequelize.define(<span class="hljs-string">&apos;task&apos;</span>, {
  title: Sequelize.STRING
}, {
  underscored: <span class="hljs-literal">true</span>
});

<span class="hljs-keyword">const</span> User = sequelize.define(<span class="hljs-string">&apos;user&apos;</span>, {
  username: Sequelize.STRING
}, {
  underscored: <span class="hljs-literal">true</span>
});

<span class="hljs-comment">// &#x5C06; userId &#x6DFB;&#x52A0;&#x5230; Task &#x6A21;&#x578B;&#xFF0C;&#x4F46;&#x5B57;&#x6BB5;&#x5C06;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A; `user_id`</span>
<span class="hljs-comment">// &#x8FD9;&#x610F;&#x5473;&#x7740;&#x5217;&#x540D;&#x5C06;&#x662F; `user_id`</span>
User.hasMany(Task);

<span class="hljs-comment">// &#x4E5F;&#x4F1A;&#x5C06; userId &#x6DFB;&#x52A0;&#x5230; Task &#x6A21;&#x578B;&#xFF0C;&#x4F46;&#x5B57;&#x6BB5;&#x5C06;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A; `user_id`</span>
<span class="hljs-comment">// &#x8FD9;&#x610F;&#x5473;&#x7740;&#x5217;&#x540D;&#x5C06;&#x662F; `user_id`</span>
Task.belongsTo(User);
</code></pre>
<p>&#x5C06;&#x751F;&#x6210;&#x4EE5;&#x4E0B;SQL&#xFF1A;</p>
<pre><code class="lang-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">&quot;users&quot;</span> (
  <span class="hljs-string">&quot;id&quot;</span> <span class="hljs-built_in">SERIAL</span>,
  <span class="hljs-string">&quot;username&quot;</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">255</span>),
  <span class="hljs-string">&quot;created_at&quot;</span> <span class="hljs-keyword">TIMESTAMP</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TIME</span> ZONE <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">&quot;updated_at&quot;</span> <span class="hljs-keyword">TIMESTAMP</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TIME</span> ZONE <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">&quot;id&quot;</span>)
);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">&quot;tasks&quot;</span> (
  <span class="hljs-string">&quot;id&quot;</span> <span class="hljs-built_in">SERIAL</span>,
  <span class="hljs-string">&quot;title&quot;</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">255</span>),
  <span class="hljs-string">&quot;created_at&quot;</span> <span class="hljs-keyword">TIMESTAMP</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TIME</span> ZONE <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">&quot;updated_at&quot;</span> <span class="hljs-keyword">TIMESTAMP</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TIME</span> ZONE <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">&quot;user_id&quot;</span> <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-string">&quot;users&quot;</span> (<span class="hljs-string">&quot;id&quot;</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span>
  <span class="hljs-keyword">SET</span>
    <span class="hljs-literal">NULL</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">CASCADE</span>,
    PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">&quot;id&quot;</span>)
);
</code></pre>
<p>&#x6CE8;&#x5165;&#x5230;&#x6A21;&#x578B;&#x4E2D;&#x7684;&#x4E0B;&#x5212;&#x7EBF;&#x9009;&#x9879;&#x5C5E;&#x6027;&#x4ECD;&#x7136;&#x662F;&#x9A86;&#x9A7C;&#x5F0F;&#x7684;&#xFF0C;&#x4F46; <code>field</code> &#x9009;&#x9879;&#x8BBE;&#x7F6E;&#x4E3A;&#x5176;&#x4E0B;&#x5212;&#x7EBF;&#x7248;&#x672C;&#x3002;</p>
<h4 id="&#x5FAA;&#x73AF;&#x4F9D;&#x8D56;--&#x7981;&#x7528;&#x7EA6;&#x675F;">&#x5FAA;&#x73AF;&#x4F9D;&#x8D56; &amp; &#x7981;&#x7528;&#x7EA6;&#x675F;</h4>
<p>&#x5728;&#x8868;&#x4E4B;&#x95F4;&#x6DFB;&#x52A0;&#x7EA6;&#x675F;&#x610F;&#x5473;&#x7740;&#x5F53;&#x4F7F;&#x7528; <code>sequelize.sync</code> &#x65F6;&#xFF0C;&#x8868;&#x5FC5;&#x987B;&#x4EE5;&#x7279;&#x5B9A;&#x987A;&#x5E8F;&#x5728;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x521B;&#x5EFA;&#x8868;&#x3002; &#x5982;&#x679C; <code>Task</code> &#x5177;&#x6709;&#x5BF9; <code>User</code> &#x7684;&#x5F15;&#x7528;&#xFF0C;<code>users</code> &#x8868;&#x5FC5;&#x987B;&#x5728;&#x521B;&#x5EFA; <code>tasks</code> &#x8868;&#x4E4B;&#x524D;&#x521B;&#x5EFA;&#x3002; &#x8FD9;&#x6709;&#x65F6;&#x4F1A;&#x5BFC;&#x81F4;&#x5FAA;&#x73AF;&#x5F15;&#x7528;&#xFF0C;&#x90A3;&#x4E48; sequelize &#x5C06;&#x65E0;&#x6CD5;&#x627E;&#x5230;&#x8981;&#x540C;&#x6B65;&#x7684;&#x987A;&#x5E8F;&#x3002; &#x60F3;&#x8C61;&#x4E00;&#x4E0B;&#x6587;&#x6863;&#x548C;&#x7248;&#x672C;&#x7684;&#x573A;&#x666F;&#x3002; &#x4E00;&#x4E2A;&#x6587;&#x6863;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#x7248;&#x672C;&#xFF0C;&#x5E76;&#x4E14;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x8D77;&#x89C1;&#xFF0C;&#x6587;&#x6863;&#x5F15;&#x7528;&#x4E86;&#x5B83;&#x7684;&#x5F53;&#x524D;&#x7248;&#x672C;&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> Document = sequelize.define(<span class="hljs-string">&apos;document&apos;</span>, {
  author: Sequelize.STRING
});
<span class="hljs-keyword">const</span> Version = sequelize.define(<span class="hljs-string">&apos;version&apos;</span>, {
  timestamp: Sequelize.DATE
});

Document.hasMany(Version); <span class="hljs-comment">// &#x8FD9;&#x5C06; documentId &#x5C5E;&#x6027;&#x6DFB;&#x52A0;&#x5230; version</span>
Document.belongsTo(Version, {
  <span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;Current&apos;</span>,
  foreignKey: <span class="hljs-string">&apos;currentVersionId&apos;</span>
}); <span class="hljs-comment">// &#x8FD9;&#x5C06; currentVersionId &#x5C5E;&#x6027;&#x6DFB;&#x52A0;&#x5230; document</span>
</code></pre>
<p>&#x4F46;&#x662F;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x5C06;&#x5BFC;&#x81F4;&#x4EE5;&#x4E0B;&#x9519;&#x8BEF;: <code>Cyclic dependency found. documents is dependent of itself. Dependency chain: documents -&gt; versions =&gt; documents</code>.</p>
<p>&#x4E3A;&#x4E86;&#x7F13;&#x89E3;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5411;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x5173;&#x8054;&#x4F20;&#x9012; <code>constraints: false</code>&#xFF1A;</p>
<pre><code class="lang-js">Document.hasMany(Version);
Document.belongsTo(Version, {
  <span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;Current&apos;</span>,
  foreignKey: <span class="hljs-string">&apos;currentVersionId&apos;</span>,
  constraints: <span class="hljs-literal">false</span>
});
</code></pre>
<p>&#x8FD9;&#x5C06;&#x53EF;&#x4EE5;&#x8BA9;&#x6211;&#x4EEC;&#x6B63;&#x786E;&#x5730;&#x540C;&#x6B65;&#x8868;&#xFF1A;</p>
<pre><code class="lang-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">&quot;documents&quot;</span> (
  <span class="hljs-string">&quot;id&quot;</span> <span class="hljs-built_in">SERIAL</span>,
  <span class="hljs-string">&quot;author&quot;</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">255</span>),
  <span class="hljs-string">&quot;createdAt&quot;</span> <span class="hljs-keyword">TIMESTAMP</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TIME</span> ZONE <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">&quot;updatedAt&quot;</span> <span class="hljs-keyword">TIMESTAMP</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TIME</span> ZONE <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">&quot;currentVersionId&quot;</span> <span class="hljs-built_in">INTEGER</span>,
  PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">&quot;id&quot;</span>)
);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">&quot;versions&quot;</span> (
  <span class="hljs-string">&quot;id&quot;</span> <span class="hljs-built_in">SERIAL</span>,
  <span class="hljs-string">&quot;timestamp&quot;</span> <span class="hljs-keyword">TIMESTAMP</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TIME</span> ZONE,
  <span class="hljs-string">&quot;createdAt&quot;</span> <span class="hljs-keyword">TIMESTAMP</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TIME</span> ZONE <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">&quot;updatedAt&quot;</span> <span class="hljs-keyword">TIMESTAMP</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TIME</span> ZONE <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">&quot;documentId&quot;</span> <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-string">&quot;documents&quot;</span> (<span class="hljs-string">&quot;id&quot;</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span>
  <span class="hljs-keyword">SET</span>
    <span class="hljs-literal">NULL</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">CASCADE</span>,
    PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">&quot;id&quot;</span>)
);
</code></pre>
<h4 id="&#x65E0;&#x9650;&#x5236;&#x5730;&#x6267;&#x884C;&#x5916;&#x952E;&#x5F15;&#x7528;">&#x65E0;&#x9650;&#x5236;&#x5730;&#x6267;&#x884C;&#x5916;&#x952E;&#x5F15;&#x7528;</h4>
<p>&#x6709;&#x65F6;&#x60A8;&#x53EF;&#x80FD;&#x60F3;&#x5F15;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x8868;&#xFF0C;&#x800C;&#x4E0D;&#x6DFB;&#x52A0;&#x4EFB;&#x4F55;&#x7EA6;&#x675F;&#x6216;&#x5173;&#x8054;&#x3002; &#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x5C06;&#x53C2;&#x8003;&#x5C5E;&#x6027;&#x6DFB;&#x52A0;&#x5230;&#x60A8;&#x7684;&#x6A21;&#x5F0F;&#x5B9A;&#x4E49;&#x4E2D;&#xFF0C;&#x5E76;&#x6807;&#x8BB0;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> Trainer = sequelize.define(<span class="hljs-string">&apos;trainer&apos;</span>, {
  firstName: Sequelize.STRING,
  lastName: Sequelize.STRING
});

<span class="hljs-comment">// Series &#x5C06;&#x6709;&#x4E00;&#x4E2A; trainerId = Trainer.id &#x5916;&#x53C2;&#x8003;&#x952E;</span>
<span class="hljs-comment">// &#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x8C03;&#x7528; Trainer.hasMany(series)</span>
<span class="hljs-keyword">const</span> Series = sequelize.define(<span class="hljs-string">&apos;series&apos;</span>, {
  title: Sequelize.STRING,
  subTitle: Sequelize.STRING,
  description: Sequelize.TEXT,
  <span class="hljs-comment">// &#x7528; `Trainer` &#x8BBE;&#x7F6E;&#x5916;&#x952E;&#x5173;&#x7CFB;&#xFF08;hasMany&#xFF09;</span>
  trainerId: {
    type: Sequelize.INTEGER,
    references: {
      model: Trainer,
      key: <span class="hljs-string">&apos;id&apos;</span>
    }
  }
});

<span class="hljs-comment">// Video &#x5C06;&#x6709; seriesId = Series.id &#x5916;&#x53C2;&#x8003;&#x952E;</span>
<span class="hljs-comment">// &#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x8C03;&#x7528; Series.hasOne(Video)</span>
<span class="hljs-keyword">const</span> Video = sequelize.define(<span class="hljs-string">&apos;video&apos;</span>, {
  title: Sequelize.STRING,
  sequence: Sequelize.INTEGER,
  description: Sequelize.TEXT,
  <span class="hljs-comment">// &#x7528; `Series` &#x8BBE;&#x7F6E;&#x5173;&#x7CFB;(hasOne) </span>
  seriesId: {
    type: Sequelize.INTEGER,
    references: {
      model: Series, <span class="hljs-comment">// &#x65E2;&#x53EF;&#x4EE5;&#x662F;&#x8868;&#x793A;&#x8868;&#x540D;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F; Sequelize &#x6A21;&#x578B;</span>
      key: <span class="hljs-string">&apos;id&apos;</span>
    }
  }
});

Series.hasOne(Video);
Trainer.hasMany(Series);
</code></pre>
<h2 id="&#x4E00;&#x5BF9;&#x4E00;&#x5173;&#x8054;">&#x4E00;&#x5BF9;&#x4E00;&#x5173;&#x8054;</h2>
<p>&#x4E00;&#x5BF9;&#x4E00;&#x5173;&#x8054;&#x662F;&#x901A;&#x8FC7;&#x5355;&#x4E2A;&#x5916;&#x952E;&#x8FDE;&#x63A5;&#x7684;&#x4E24;&#x4E2A;&#x6A21;&#x578B;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x8054;&#x3002;</p>
<h3 id="belongsto">BelongsTo</h3>
<p>BelongsTo &#x5173;&#x8054;&#x662F;&#x5728; <strong>source model</strong> &#x4E0A;&#x5B58;&#x5728;&#x4E00;&#x5BF9;&#x4E00;&#x5173;&#x7CFB;&#x7684;&#x5916;&#x952E;&#x7684;&#x5173;&#x8054;&#x3002;</p>
<p>&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#x662F; <strong>Player</strong> &#x901A;&#x8FC7; player &#x7684;&#x5916;&#x952E;&#x4F5C;&#x4E3A; <strong>Team</strong> &#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> Player = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;player&apos;</span>, {<span class="hljs-comment">/* attributes */</span>});
<span class="hljs-keyword">const</span> Team  = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;team&apos;</span>, {<span class="hljs-comment">/* attributes */</span>});

Player.belongsTo(Team); <span class="hljs-comment">// &#x5C06;&#x5411; Player &#x6DFB;&#x52A0;&#x4E00;&#x4E2A; teamId &#x5C5E;&#x6027;&#x4EE5;&#x4FDD;&#x5B58; Team &#x7684;&#x4E3B;&#x952E;&#x503C;</span>
</code></pre>
<h4 id="&#x5916;&#x952E;">&#x5916;&#x952E;</h4>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5C06;&#x4ECE;&#x76EE;&#x6807;&#x6A21;&#x578B;&#x540D;&#x79F0;&#x548C;&#x76EE;&#x6807;&#x4E3B;&#x952E;&#x540D;&#x79F0;&#x751F;&#x6210; belongsTo &#x5173;&#x7CFB;&#x7684;&#x5916;&#x952E;&#x3002;</p>
<p>&#x9ED8;&#x8BA4;&#x7684;&#x6837;&#x5F0F;&#x662F; <code>camelCase</code>&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x6E90;&#x6A21;&#x578B;&#x914D;&#x7F6E;&#x4E3A; <code>underscored: true</code> &#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x4F7F;&#x7528;&#x5B57;&#x6BB5; <code>snake_case</code> &#x521B;&#x5EFA; foreignKey&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> User = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;user&apos;</span>, {<span class="hljs-comment">/* attributes */</span>})
<span class="hljs-keyword">const</span> Company  = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;company&apos;</span>, {<span class="hljs-comment">/* attributes */</span>});

<span class="hljs-comment">// &#x5C06; companyId &#x6DFB;&#x52A0;&#x5230; user</span>
User.belongsTo(Company); 

<span class="hljs-keyword">const</span> User = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;user&apos;</span>, {<span class="hljs-comment">/* attributes */</span>}, {underscored: <span class="hljs-literal">true</span>})
<span class="hljs-keyword">const</span> Company  = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;company&apos;</span>, {
  uuid: {
    type: Sequelize.UUID,
    primaryKey: <span class="hljs-literal">true</span>
  }
});

<span class="hljs-comment">// &#x5C06;&#x7528;&#x5B57;&#x6BB5; company_uuid &#x6DFB;&#x52A0; companyUuid &#x5230; user</span>
User.belongsTo(Company);
</code></pre>
<p>&#x5728;&#x5DF2;&#x5B9A;&#x4E49; <code>as</code> &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5C06;&#x4F7F;&#x7528;&#x5B83;&#x4EE3;&#x66FF;&#x76EE;&#x6807;&#x6A21;&#x578B;&#x540D;&#x79F0;&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> User = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;user&apos;</span>, {<span class="hljs-comment">/* attributes */</span>})
<span class="hljs-keyword">const</span> UserRole  = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;userRole&apos;</span>, {<span class="hljs-comment">/* attributes */</span>});

User.belongsTo(UserRole, {<span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;role&apos;</span>}); <span class="hljs-comment">// &#x5C06; role &#x6DFB;&#x52A0;&#x5230; user &#x800C;&#x4E0D;&#x662F; userRole</span>
</code></pre>
<p>&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x9ED8;&#x8BA4;&#x5916;&#x952E;&#x53EF;&#x4EE5;&#x7528; <code>foreignKey</code> &#x9009;&#x9879;&#x8986;&#x76D6;&#x3002;
&#x5F53;&#x4F7F;&#x7528;&#x5916;&#x952E;&#x9009;&#x9879;&#x65F6;&#xFF0C;Sequelize &#x5C06;&#x6309;&#x539F;&#x6837;&#x4F7F;&#x7528;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> User = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;user&apos;</span>, {<span class="hljs-comment">/* attributes */</span>})
<span class="hljs-keyword">const</span> Company  = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;company&apos;</span>, {<span class="hljs-comment">/* attributes */</span>});

User.belongsTo(Company, {foreignKey: <span class="hljs-string">&apos;fk_company&apos;</span>}); <span class="hljs-comment">// &#x5C06; fk_company &#x6DFB;&#x52A0;&#x5230; User</span>
</code></pre>
<h4 id="&#x76EE;&#x6807;&#x952E;">&#x76EE;&#x6807;&#x952E;</h4>
<p>&#x76EE;&#x6807;&#x952E;&#x662F;&#x6E90;&#x6A21;&#x578B;&#x4E0A;&#x7684;&#x5916;&#x952E;&#x5217;&#x6307;&#x5411;&#x7684;&#x76EE;&#x6807;&#x6A21;&#x578B;&#x4E0A;&#x7684;&#x5217;&#x3002; &#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;belongsTo &#x5173;&#x7CFB;&#x7684;&#x76EE;&#x6807;&#x952E;&#x5C06;&#x662F;&#x76EE;&#x6807;&#x6A21;&#x578B;&#x7684;&#x4E3B;&#x952E;&#x3002; &#x8981;&#x5B9A;&#x4E49;&#x81EA;&#x5B9A;&#x4E49;&#x5217;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528; <code>targetKey</code> &#x9009;&#x9879;&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> User = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;user&apos;</span>, {<span class="hljs-comment">/* attributes */</span>})
<span class="hljs-keyword">const</span> Company  = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;company&apos;</span>, {<span class="hljs-comment">/* attributes */</span>});

User.belongsTo(Company, {foreignKey: <span class="hljs-string">&apos;fk_companyname&apos;</span>, targetKey: <span class="hljs-string">&apos;name&apos;</span>}); <span class="hljs-comment">// &#x6DFB;&#x52A0; fk_companyname &#x5230; User</span>
</code></pre>
<h3 id="hasone">HasOne</h3>
<p>HasOne &#x5173;&#x8054;&#x662F;&#x5728; <strong>target model</strong> &#x4E0A;&#x5B58;&#x5728;&#x4E00;&#x5BF9;&#x4E00;&#x5173;&#x7CFB;&#x7684;&#x5916;&#x952E;&#x7684;&#x5173;&#x8054;&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> User = sequelize.define(<span class="hljs-string">&apos;user&apos;</span>, {<span class="hljs-comment">/* ... */</span>})
<span class="hljs-keyword">const</span> Project = sequelize.define(<span class="hljs-string">&apos;project&apos;</span>, {<span class="hljs-comment">/* ... */</span>})

<span class="hljs-comment">// &#x5355;&#x5411;&#x5173;&#x8054;</span>
Project.hasOne(User)

<span class="hljs-comment">/*
  &#x5728;&#x6B64;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;hasOne &#x5C06;&#x5411; User &#x6A21;&#x578B;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A; projectId &#x5C5E;&#x6027; &#xFF01; 
  &#x6B64;&#x5916;&#xFF0C;Project.prototype &#x5C06;&#x6839;&#x636E;&#x4F20;&#x9012;&#x7ED9;&#x5B9A;&#x4E49;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x83B7;&#x53D6; getUser &#x548C; setUser &#x7684;&#x65B9;&#x6CD5;&#x3002; 
  &#x5982;&#x679C;&#x542F;&#x7528;&#x4E86; underscore &#x6837;&#x5F0F;&#xFF0C;&#x5219;&#x6DFB;&#x52A0;&#x7684;&#x5C5E;&#x6027;&#x5C06;&#x662F; project_id &#x800C;&#x4E0D;&#x662F; projectId&#x3002;

  &#x5916;&#x952E;&#x5C06;&#x653E;&#x5728; users &#x8868;&#x4E0A;&#x3002;

  &#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x5916;&#x952E;&#xFF0C;&#x4F8B;&#x5982; &#x5982;&#x679C;&#x60A8;&#x5DF2;&#x7ECF;&#x6709;&#x4E00;&#x4E2A;&#x73B0;&#x6709;&#x7684;&#x6570;&#x636E;&#x5E93;&#x5E76;&#x4E14;&#x60F3;&#x8981;&#x5904;&#x7406;&#x5B83;&#xFF1A;
*/</span>

Project.hasOne(User, { foreignKey: <span class="hljs-string">&apos;initiator_id&apos;</span> })

<span class="hljs-comment">/*
  &#x56E0;&#x4E3A;Sequelize&#x5C06;&#x4F7F;&#x7528;&#x6A21;&#x578B;&#x7684;&#x540D;&#x79F0;&#xFF08;define&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF09;&#x4F5C;&#x4E3A;&#x8BBF;&#x95EE;&#x5668;&#x65B9;&#x6CD5;&#xFF0C;
  &#x8FD8;&#x53EF;&#x4EE5;&#x5C06;&#x7279;&#x6B8A;&#x9009;&#x9879;&#x4F20;&#x9012;&#x7ED9;hasOne&#xFF1A;
*/</span>

Project.hasOne(User, { <span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;Initiator&apos;</span> })
<span class="hljs-comment">// &#x73B0;&#x5728;&#x4F60;&#x53EF;&#x4EE5;&#x83B7;&#x5F97; Project.getInitiator &#x548C; Project.setInitiator</span>

<span class="hljs-comment">// &#x6216;&#x8005;&#x8BA9;&#x6211;&#x4EEC;&#x6765;&#x5B9A;&#x4E49;&#x4E00;&#x4E9B;&#x81EA;&#x5DF1;&#x7684;&#x53C2;&#x8003;</span>
<span class="hljs-keyword">const</span> Person = sequelize.define(<span class="hljs-string">&apos;person&apos;</span>, { <span class="hljs-comment">/* ... */</span>})

Person.hasOne(Person, {<span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;Father&apos;</span>})
<span class="hljs-comment">// &#x8FD9;&#x4F1A;&#x5C06;&#x5C5E;&#x6027; FatherId &#x6DFB;&#x52A0;&#x5230; Person</span>

<span class="hljs-comment">// also possible:</span>
Person.hasOne(Person, {<span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;Father&apos;</span>, foreignKey: <span class="hljs-string">&apos;DadId&apos;</span>})
<span class="hljs-comment">// &#x8FD9;&#x5C06;&#x628A;&#x5C5E;&#x6027; DadId &#x6DFB;&#x52A0;&#x5230; Person</span>

<span class="hljs-comment">// &#x5728;&#x8FD9;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F60;&#x90FD;&#x53EF;&#x4EE5;&#xFF1A;</span>
Person.setFather
Person.getFather

<span class="hljs-comment">// &#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x8054;&#x7ED3;&#x8868;&#x4E24;&#x6B21;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x8054;&#x7ED3;&#x540C;&#x4E00;&#x5F20;&#x8868;</span>
Team.hasOne(Game, {<span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;HomeTeam&apos;</span>, foreignKey : <span class="hljs-string">&apos;homeTeamId&apos;</span>});
Team.hasOne(Game, {<span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;AwayTeam&apos;</span>, foreignKey : <span class="hljs-string">&apos;awayTeamId&apos;</span>});

Game.belongsTo(Team);
</code></pre>
<p>&#x5373;&#x4F7F;&#x5B83;&#x88AB;&#x79F0;&#x4E3A; HasOne &#x5173;&#x8054;&#xFF0C;&#x5BF9;&#x4E8E;&#x5927;&#x591A;&#x6570;1&#xFF1A;1&#x5173;&#x7CFB;&#xFF0C;&#x60A8;&#x901A;&#x5E38;&#x9700;&#x8981;BelongsTo&#x5173;&#x8054;&#xFF0C;&#x56E0;&#x4E3A; BelongsTo &#x5C06;&#x4F1A;&#x5728; hasOne &#x5C06;&#x6DFB;&#x52A0;&#x5230;&#x76EE;&#x6807;&#x7684;&#x6E90;&#x4E0A;&#x6DFB;&#x52A0; foreignKey&#x3002;</p>
<h4 id="&#x6E90;&#x952E;">&#x6E90;&#x952E;</h4>
<p>&#x6E90;&#x5173;&#x952E;&#x662F;&#x6E90;&#x6A21;&#x578B;&#x4E2D;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x5B83;&#x7684;&#x76EE;&#x6807;&#x6A21;&#x578B;&#x6307;&#x5411;&#x5916;&#x952E;&#x5C5E;&#x6027;&#x3002; &#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;<code>hasOne</code> &#x5173;&#x7CFB;&#x7684;&#x6E90;&#x952E;&#x5C06;&#x662F;&#x6E90;&#x6A21;&#x578B;&#x7684;&#x4E3B;&#x8981;&#x5C5E;&#x6027;&#x3002; &#x8981;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528; <code>sourceKey</code> &#x9009;&#x9879;&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> User = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;user&apos;</span>, {<span class="hljs-comment">/* &#x5C5E;&#x6027; */</span>})
<span class="hljs-keyword">const</span> Company  = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;company&apos;</span>, {<span class="hljs-comment">/* &#x5C5E;&#x6027; */</span>});

<span class="hljs-comment">// &#x5C06; companyName &#x5C5E;&#x6027;&#x6DFB;&#x52A0;&#x5230; User</span>
<span class="hljs-comment">// &#x4F7F;&#x7528; Company &#x7684; name &#x5C5E;&#x6027;&#x4F5C;&#x4E3A;&#x6E90;&#x5C5E;&#x6027;</span>
Company.hasOne(User, {foreignKey: <span class="hljs-string">&apos;companyName&apos;</span>, sourceKey: <span class="hljs-string">&apos;name&apos;</span>});
</code></pre>
<h3 id="hasone-&#x548C;-belongsto-&#x4E4B;&#x95F4;&#x7684;&#x533A;&#x522B;">HasOne &#x548C; BelongsTo &#x4E4B;&#x95F4;&#x7684;&#x533A;&#x522B;</h3>
<p>&#x5728;Sequelize 1&#xFF1A;1&#x5173;&#x7CFB;&#x4E2D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;HasOne&#x548C;BelongsTo&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;&#x3002; &#x5B83;&#x4EEC;&#x9002;&#x7528;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x573A;&#x666F;&#x3002; &#x8BA9;&#x6211;&#x4EEC;&#x7528;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x6765;&#x7814;&#x7A76;&#x8FD9;&#x4E2A;&#x5DEE;&#x5F02;&#x3002;</p>
<p>&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x6709;&#x4E24;&#x4E2A;&#x8868;&#x53EF;&#x4EE5;&#x94FE;&#x63A5; <strong>Player</strong> &#x548C; <strong>Team</strong> &#x3002; &#x8BA9;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4ED6;&#x4EEC;&#x7684;&#x6A21;&#x578B;&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> Player = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;player&apos;</span>, {<span class="hljs-comment">/* attributes */</span>})
<span class="hljs-keyword">const</span> Team  = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;team&apos;</span>, {<span class="hljs-comment">/* attributes */</span>});
</code></pre>
<p>&#x5F53;&#x6211;&#x4EEC;&#x8FDE;&#x63A5; Sequelize &#x4E2D;&#x7684;&#x4E24;&#x4E2A;&#x6A21;&#x578B;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x5B83;&#x4EEC;&#x79F0;&#x4E3A;&#x4E00;&#x5BF9; <strong>source</strong> &#x548C; <strong>target</strong> &#x6A21;&#x578B;&#x3002;&#x50CF;&#x8FD9;&#x6837;</p>
<p>&#x5C06; <strong>Player</strong> &#x4F5C;&#x4E3A; <strong>source</strong> &#x800C; <strong>Team</strong> &#x4F5C;&#x4E3A; <strong>target</strong></p>
<pre><code class="lang-js">Player.belongsTo(Team);
<span class="hljs-comment">//&#x6216;</span>
Player.hasOne(Team);
</code></pre>
<p>&#x5C06; <strong>Team</strong> &#x4F5C;&#x4E3A; <strong>source</strong> &#x800C; <strong>Player</strong> &#x4F5C;&#x4E3A; <strong>target</strong></p>
<pre><code class="lang-js">Team.belongsTo(Player);
<span class="hljs-comment">//Or</span>
Team.hasOne(Player);
</code></pre>
<p>HasOne &#x548C; BelongsTo &#x5C06;&#x5173;&#x8054;&#x952E;&#x63D2;&#x5165;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x6A21;&#x578B;&#x4E2D;&#x3002; HasOne &#x5728; <strong>target</strong> &#x6A21;&#x578B;&#x4E2D;&#x63D2;&#x5165;&#x5173;&#x8054;&#x952E;&#xFF0C;&#x800C; BelongsTo &#x5C06;&#x5173;&#x8054;&#x952E;&#x63D2;&#x5165;&#x5230; <strong>source</strong> &#x6A21;&#x578B;&#x4E2D;&#x3002;</p>
<p>&#x4E0B;&#x662F;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#xFF0C;&#x8BF4;&#x660E;&#x4E86; BelongsTo &#x548C; HasOne &#x7684;&#x7528;&#x6CD5;&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> Player = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;player&apos;</span>, {<span class="hljs-comment">/* attributes */</span>})
<span class="hljs-keyword">const</span> Coach  = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;coach&apos;</span>, {<span class="hljs-comment">/* attributes */</span>})
<span class="hljs-keyword">const</span> Team  = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;team&apos;</span>, {<span class="hljs-comment">/* attributes */</span>});
</code></pre>
<p>&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x7684; <code>Player</code> &#x6A21;&#x578B;&#x6709;&#x5173;&#x4E8E;&#x5176;&#x56E2;&#x961F;&#x7684;&#x4FE1;&#x606F;&#x4E3A; <code>teamId</code> &#x5217;&#x3002; &#x5173;&#x4E8E;&#x6BCF;&#x4E2A;&#x56E2;&#x961F;&#x7684; <code>Coach</code> &#x7684;&#x4FE1;&#x606F;&#x4F5C;&#x4E3A; <code>coachId</code> &#x5217;&#x5B58;&#x50A8;&#x5728; <code>Team</code> &#x6A21;&#x578B;&#x4E2D;&#x3002; &#x8FD9;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x90FD;&#x9700;&#x8981;&#x4E0D;&#x540C;&#x79CD;&#x7C7B;&#x7684;1&#xFF1A;1&#x5173;&#x7CFB;&#xFF0C;&#x56E0;&#x4E3A;&#x5916;&#x952E;&#x5173;&#x7CFB;&#x6BCF;&#x6B21;&#x51FA;&#x73B0;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x6A21;&#x578B;&#x4E0A;&#x3002;</p>
<p>&#x5F53;&#x5173;&#x4E8E;&#x5173;&#x8054;&#x7684;&#x4FE1;&#x606F;&#x5B58;&#x5728;&#x4E8E; <strong>source</strong> &#x6A21;&#x578B;&#x4E2D;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>belongsTo</code>&#x3002; &#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;<code>Player</code> &#x9002;&#x7528;&#x4E8E; <code>belongsTo</code>&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5177;&#x6709; <code>teamId</code> &#x5217;&#x3002;</p>
<pre><code class="lang-js">Player.belongsTo(Team)  <span class="hljs-comment">// `teamId` &#x5C06;&#x88AB;&#x6DFB;&#x52A0;&#x5230; Player / Source &#x6A21;&#x578B;&#x4E2D;</span>
</code></pre>
<p>&#x5F53;&#x5173;&#x4E8E;&#x5173;&#x8054;&#x7684;&#x4FE1;&#x606F;&#x5B58;&#x5728;&#x4E8E; <strong>target</strong> &#x6A21;&#x578B;&#x4E2D;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>hasOne</code>&#x3002; &#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C; <code>Coach</code> &#x9002;&#x7528;&#x4E8E; <code>hasOne</code> &#xFF0C;&#x56E0;&#x4E3A; <code>Team</code> &#x6A21;&#x578B;&#x5C06;&#x5176; <code>Coach</code> &#x7684;&#x4FE1;&#x606F;&#x5B58;&#x50A8;&#x4E3A; <code>coachId</code> &#x5B57;&#x6BB5;&#x3002;</p>
<pre><code class="lang-js">Coach.hasOne(Team)  <span class="hljs-comment">// `coachId` &#x5C06;&#x88AB;&#x6DFB;&#x52A0;&#x5230; Team / Target &#x6A21;&#x578B;&#x4E2D;</span>
</code></pre>
<h2 id="&#x4E00;&#x5BF9;&#x591A;&#x5173;&#x8054;-hasmany">&#x4E00;&#x5BF9;&#x591A;&#x5173;&#x8054; (hasMany)</h2>
<p>&#x4E00;&#x5BF9;&#x591A;&#x5173;&#x8054;&#x5C06;&#x4E00;&#x4E2A;&#x6765;&#x6E90;&#x4E0E;&#x591A;&#x4E2A;&#x76EE;&#x6807;&#x8FDE;&#x63A5;&#x8D77;&#x6765;&#x3002; &#x800C;&#x591A;&#x4E2A;&#x76EE;&#x6807;&#x63A5;&#x5230;&#x540C;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x6E90;&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> User = sequelize.define(<span class="hljs-string">&apos;user&apos;</span>, {<span class="hljs-comment">/* ... */</span>})
<span class="hljs-keyword">const</span> Project = sequelize.define(<span class="hljs-string">&apos;project&apos;</span>, {<span class="hljs-comment">/* ... */</span>})

<span class="hljs-comment">// &#x597D;&#x3002; &#x73B0;&#x5728;&#xFF0C;&#x4E8B;&#x60C5;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x590D;&#x6742;&#xFF08;&#x5BF9;&#x7528;&#x6237;&#x6765;&#x8BF4;&#x5E76;&#x4E0D;&#x771F;&#x5B9E;&#x53EF;&#x89C1;&#xFF09;&#x3002;</span>
<span class="hljs-comment">// &#x9996;&#x5148;&#x6211;&#x4EEC;&#x6765;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A; hasMany &#x5173;&#x8054;</span>
Project.hasMany(User, {<span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;Workers&apos;</span>})
</code></pre>
<p>&#x8FD9;&#x4F1A;&#x5C06;<code>projectId</code> &#x5C5E;&#x6027;&#x6DFB;&#x52A0;&#x5230; User&#x3002; &#x6839;&#x636E;&#x60A8;&#x5F3A;&#x8C03;&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x8868;&#x4E2D;&#x7684;&#x5217;&#x5C06;&#x88AB;&#x79F0;&#x4E3A; <code>projectId</code> &#x6216;<code>project_id</code>&#x3002; Project &#x7684;&#x5B9E;&#x4F8B;&#x5C06;&#x83B7;&#x5F97;&#x8BBF;&#x95EE;&#x5668; <code>getWorkers</code> &#x548C; <code>setWorkers</code>&#x3002; </p>
<p>&#x6709;&#x65F6;&#x60A8;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x5217;&#x4E0A;&#x5173;&#x8054;&#x8BB0;&#x5F55;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>sourceKey</code> &#x9009;&#x9879;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> City = sequelize.define(<span class="hljs-string">&apos;city&apos;</span>, { countryCode: Sequelize.STRING });
<span class="hljs-keyword">const</span> Country = sequelize.define(<span class="hljs-string">&apos;country&apos;</span>, { isoCode: Sequelize.STRING });

<span class="hljs-comment">// &#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x56FD;&#x5BB6;&#x4EE3;&#x7801;&#x8FDE;&#x63A5;&#x56FD;&#x5BB6;&#x548C;&#x57CE;&#x5E02;</span>
Country.hasMany(City, {foreignKey: <span class="hljs-string">&apos;countryCode&apos;</span>, sourceKey: <span class="hljs-string">&apos;isoCode&apos;</span>});
City.belongsTo(Country, {foreignKey: <span class="hljs-string">&apos;countryCode&apos;</span>, targetKey: <span class="hljs-string">&apos;isoCode&apos;</span>});
</code></pre>
<p>&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#xFF0C;&#x6211;&#x4EEC;&#x89E3;&#x51B3;&#x4E86;&#x5355;&#x5411;&#x5173;&#x8054;&#x3002; &#x4F46;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x66F4;&#x591A;&#xFF01; &#x8BA9;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x5728;&#x4E0B;&#x4E00;&#x8282;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x591A;&#x5BF9;&#x591A;&#x7684;&#x5173;&#x8054;&#x6765;&#x5B9A;&#x4E49;&#x5B83;&#x3002;</p>
<h2 id="&#x591A;&#x5BF9;&#x591A;&#x5173;&#x8054;">&#x591A;&#x5BF9;&#x591A;&#x5173;&#x8054;</h2>
<p>&#x591A;&#x5BF9;&#x591A;&#x5173;&#x8054;&#x7528;&#x4E8E;&#x5C06;&#x6E90;&#x4E0E;&#x591A;&#x4E2A;&#x76EE;&#x6807;&#x76F8;&#x8FDE;&#x63A5;&#x3002; &#x6B64;&#x5916;&#xFF0C;&#x76EE;&#x6807;&#x4E5F;&#x53EF;&#x4EE5;&#x8FDE;&#x63A5;&#x5230;&#x591A;&#x4E2A;&#x6E90;&#x3002;</p>
<pre><code class="lang-js">Project.belongsToMany(User, {through: <span class="hljs-string">&apos;UserProject&apos;</span>});
User.belongsToMany(Project, {through: <span class="hljs-string">&apos;UserProject&apos;</span>});
</code></pre>
<p>&#x8FD9;&#x5C06;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; UserProject &#x7684;&#x65B0;&#x6A21;&#x578B;&#xFF0C;&#x5177;&#x6709;&#x7B49;&#x6548;&#x7684;&#x5916;&#x952E;<code>projectId</code>&#x548C;<code>userId</code>&#x3002; &#x5C5E;&#x6027;&#x662F;&#x5426;&#x4E3A;<code>camelcase</code>&#x53D6;&#x51B3;&#x4E8E;&#x7531;&#x8868;&#xFF08;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x4E3A;<code>User</code>&#x548C;<code>Project</code>&#xFF09;&#x8FDE;&#x63A5;&#x7684;&#x4E24;&#x4E2A;&#x6A21;&#x578B;&#x3002;</p>
<p>&#x5B9A;&#x4E49; <code>through</code> &#x4E3A; <strong>required</strong>&#x3002; Sequelize &#x4EE5;&#x524D;&#x4F1A;&#x5C1D;&#x8BD5;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x540D;&#x79F0;&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x603B;&#x662F;&#x5BFC;&#x81F4;&#x6700;&#x5408;&#x4E4E;&#x903B;&#x8F91;&#x7684;&#x8BBE;&#x7F6E;&#x3002;</p>
<p>&#x8FD9;&#x5C06;&#x6DFB;&#x52A0;&#x65B9;&#x6CD5; <code>getUsers</code>, <code>setUsers</code>, <code>addUser</code>,<code>addUsers</code> &#x5230; <code>Project</code>, &#x8FD8;&#x6709; <code>getProjects</code>, <code>setProjects</code>, <code>addProject</code>, &#x548C; <code>addProjects</code> &#x5230; <code>User</code>.</p>
<p>&#x6709;&#x65F6;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5728;&#x5173;&#x8054;&#x4E2D;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x65F6;&#x91CD;&#x547D;&#x540D;&#x6A21;&#x578B;&#x3002; &#x8BA9;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x522B;&#x540D;&#xFF08;<code>as</code>&#xFF09;&#x9009;&#x9879;&#x5C06; users &#x5B9A;&#x4E49;&#x4E3A; workers &#x800C; projects &#x5B9A;&#x4E49;&#x4E3A;t asks&#x3002; &#x6211;&#x4EEC;&#x8FD8;&#x5C06;&#x624B;&#x52A8;&#x5B9A;&#x4E49;&#x8981;&#x4F7F;&#x7528;&#x7684;&#x5916;&#x952E;&#xFF1A;</p>
<pre><code class="lang-js">User.belongsToMany(Project, { <span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;Tasks&apos;</span>, through: <span class="hljs-string">&apos;worker_tasks&apos;</span>, foreignKey: <span class="hljs-string">&apos;userId&apos;</span> })
Project.belongsToMany(User, { <span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;Workers&apos;</span>, through: <span class="hljs-string">&apos;worker_tasks&apos;</span>, foreignKey: <span class="hljs-string">&apos;projectId&apos;</span> })
</code></pre>
<p><code>foreignKey</code> &#x5C06;&#x5141;&#x8BB8;&#x4F60;&#x5728; <strong>through</strong> &#x5173;&#x7CFB;&#x4E2D;&#x8BBE;&#x7F6E; <strong>source model</strong> &#x952E;&#x3002;</p>
<p><code>otherKey</code> &#x5C06;&#x5141;&#x8BB8;&#x4F60;&#x5728; <strong>through</strong> &#x5173;&#x7CFB;&#x4E2D;&#x8BBE;&#x7F6E; <strong>target model</strong> &#x952E;&#x3002;</p>
<pre><code class="lang-js">User.belongsToMany(Project, { <span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;Tasks&apos;</span>, through: <span class="hljs-string">&apos;worker_tasks&apos;</span>, foreignKey: <span class="hljs-string">&apos;userId&apos;</span>, otherKey: <span class="hljs-string">&apos;projectId&apos;</span>})
</code></pre>
<p>&#x5F53;&#x7136;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; belongsToMany &#x5B9A;&#x4E49;&#x81EA;&#x6211;&#x5F15;&#x7528;&#xFF1A;</p>
<pre><code class="lang-js">Person.belongsToMany(Person, { <span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;Children&apos;</span>, through: <span class="hljs-string">&apos;PersonChildren&apos;</span> })
<span class="hljs-comment">// &#x8FD9;&#x5C06;&#x521B;&#x5EFA;&#x5B58;&#x50A8;&#x5BF9;&#x8C61;&#x7684; ID &#x7684;&#x8868; PersonChildren&#x3002;</span>
</code></pre>
<p>&#x5982;&#x679C;&#x60A8;&#x60F3;&#x8981;&#x8FDE;&#x63A5;&#x8868;&#x4E2D;&#x7684;&#x5176;&#x4ED6;&#x5C5E;&#x6027;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5728;&#x5B9A;&#x4E49;&#x5173;&#x8054;&#x4E4B;&#x524D;&#x4E3A;&#x8FDE;&#x63A5;&#x8868;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x6A21;&#x578B;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8BF4;&#x660E;&#x5B83;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x8BE5;&#x6A21;&#x578B;&#x8FDB;&#x884C;&#x8FDE;&#x63A5;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5173;&#x8054;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> User = sequelize.define(<span class="hljs-string">&apos;user&apos;</span>, {})
<span class="hljs-keyword">const</span> Project = sequelize.define(<span class="hljs-string">&apos;project&apos;</span>, {})
<span class="hljs-keyword">const</span> UserProjects = sequelize.define(<span class="hljs-string">&apos;userProjects&apos;</span>, {
    status: DataTypes.STRING
})

User.belongsToMany(Project, { through: UserProjects })
Project.belongsToMany(User, { through: UserProjects })
</code></pre>
<p>&#x8981;&#x5411; user &#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x65B0; project &#x5E76;&#x8BBE;&#x7F6E;&#x5176;&#x72B6;&#x6001;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5C06;&#x989D;&#x5916;&#x7684; <code>options.through</code> &#x4F20;&#x9012;&#x7ED9; setter&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x8FDE;&#x63A5;&#x8868;&#x7684;&#x5C5E;&#x6027;</p>
<pre><code class="lang-js">user.addProject(project, { through: { status: <span class="hljs-string">&apos;started&apos;</span> }})
</code></pre>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4F1A;&#x5C06; projectId &#x548C; userId &#x6DFB;&#x52A0;&#x5230; UserProjects &#x8868;&#x4E2D;&#xFF0C; <em>&#x5220;&#x9664;&#x4EFB;&#x4F55;&#x5148;&#x524D;&#x5B9A;&#x4E49;&#x7684;&#x4E3B;&#x952E;&#x5C5E;&#x6027;</em> - &#x8868;&#x5C06;&#x7531;&#x4E24;&#x4E2A;&#x8868;&#x7684;&#x952E;&#x7684;&#x7EC4;&#x5408;&#x552F;&#x4E00;&#x6807;&#x8BC6;&#xFF0C;&#x5E76;&#x4E14;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x4E3B;&#x952E;&#x5217;&#x3002; &#x8981;&#x5728; <code>UserProjects</code> &#x6A21;&#x578B;&#x4E0A;&#x5F3A;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x4E3B;&#x952E;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x6DFB;&#x52A0;&#x5B83;&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> UserProjects = sequelize.define(<span class="hljs-string">&apos;userProjects&apos;</span>, {
  id: {
    type: Sequelize.INTEGER,
    primaryKey: <span class="hljs-literal">true</span>,
    autoIncrement: <span class="hljs-literal">true</span>
  },
  status: DataTypes.STRING
})
</code></pre>
<p>&#x4F7F;&#x7528;&#x591A;&#x5BF9;&#x591A;&#x4F60;&#x53EF;&#x4EE5;&#x57FA;&#x4E8E; <strong>through</strong> &#x5173;&#x7CFB;&#x67E5;&#x8BE2;&#x5E76;&#x9009;&#x62E9;&#x7279;&#x5B9A;&#x5C5E;&#x6027;&#x3002; &#x4F8B;&#x5982;&#x901A;&#x8FC7; <strong>through</strong> &#x4F7F;&#x7528;<code>findAll</code></p>
<pre><code class="lang-js">User.findAll({
  include: [{
    model: Project,
    through: {
      attributes: [<span class="hljs-string">&apos;createdAt&apos;</span>, <span class="hljs-string">&apos;startedAt&apos;</span>, <span class="hljs-string">&apos;finishedAt&apos;</span>],
      where: {completed: <span class="hljs-literal">true</span>}
    }
  }]
});
</code></pre>
<h2 id="&#x547D;&#x540D;&#x7B56;&#x7565;">&#x547D;&#x540D;&#x7B56;&#x7565;</h2>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Sequelize&#x5C06;&#x4F7F;&#x7528;&#x6A21;&#x578B;&#x540D;&#x79F0;&#xFF08;&#x4F20;&#x9012;&#x7ED9;<code>sequelize.define</code>&#x7684;&#x540D;&#x79F0;&#xFF09;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x5173;&#x8054;&#x65F6;&#x4F7F;&#x7528;&#x6A21;&#x578B;&#x540D;&#x79F0;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<code>user</code>&#x7684;&#x6A21;&#x578B;&#x4F1A;&#x5C06;&#x5173;&#x8054;&#x6A21;&#x578B;&#x7684;&#x5B9E;&#x4F8B;&#x4E2D;&#x7684;<code>get / set / add User</code>&#x51FD;&#x6570;&#x548C;&#x52A0;&#x5165;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<code>.user</code>&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x800C;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<code>User</code>&#x7684;&#x6A21;&#x578B;&#x4F1A;&#x6DFB;&#x52A0;&#x76F8;&#x540C;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x548C;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<code>.User</code>&#x7684;&#x5C5E;&#x6027;&#xFF08;&#x6CE8;&#x610F;&#x5927;&#x5199;U&#xFF09;&#x3002;</p>
<p>&#x6B63;&#x5982;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x770B;&#x5230;&#x7684;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>as</code>&#x6765;&#x5173;&#x8054;&#x6A21;&#x578B;&#x3002; &#x5728;&#x5355;&#x4E2A;&#x5173;&#x8054;&#xFF08;has one &#x548C; belongs to&#xFF09;&#xFF0C;&#x522B;&#x540D;&#x5E94;&#x8BE5;&#x662F;&#x5355;&#x6570;&#xFF0C;&#x800C;&#x5BF9;&#x4E8E;&#x8BB8;&#x591A;&#x5173;&#x8054;&#xFF08;has many&#xFF09;&#x5B83;&#x5E94;&#x8BE5;&#x662F;&#x590D;&#x6570;&#x3002; Sequelize&#x7136;&#x540E;&#x4F7F;&#x7528;<a href="https://www.npmjs.org/package/inflection" target="_blank">inflection</a>&#x5E93;&#x5C06;&#x522B;&#x540D;&#x8F6C;&#x6362;&#x4E3A;&#x5176;&#x5355;&#x6570;&#x5F62;&#x5F0F;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x53EF;&#x80FD;&#x5E76;&#x4E0D;&#x603B;&#x662F;&#x9002;&#x7528;&#x4E8E;&#x4E0D;&#x89C4;&#x5219;&#x6216;&#x975E;&#x82F1;&#x8BED;&#x5355;&#x8BCD;&#x3002; &#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x590D;&#x6570;&#x548C;&#x5355;&#x6570;&#x5F62;&#x5F0F;&#x7684;&#x522B;&#x540D;&#xFF1A;</p>
<pre><code class="lang-js">User.belongsToMany(Project, { <span class="hljs-keyword">as</span>: { singular: <span class="hljs-string">&apos;task&apos;</span>, plural: <span class="hljs-string">&apos;tasks&apos;</span> }})
<span class="hljs-comment">// Notice that inflection has no problem singularizing tasks, this is just for illustrative purposes.</span>
</code></pre>
<p>&#x5982;&#x679C;&#x4F60;&#x77E5;&#x9053;&#x6A21;&#x578B;&#x5C06;&#x59CB;&#x7EC8;&#x5728;&#x5173;&#x8054;&#x4E2D;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5728;&#x521B;&#x5EFA;&#x6A21;&#x578B;&#x65F6;&#x63D0;&#x4F9B;&#x5B83;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> Project = sequelize.define(<span class="hljs-string">&apos;project&apos;</span>, attributes, {
  name: {
    singular: <span class="hljs-string">&apos;task&apos;</span>,
    plural: <span class="hljs-string">&apos;tasks&apos;</span>,
  }
})

User.belongsToMany(Project);
</code></pre>
<p>&#x8FD9;&#x5C06;&#x4E3A;&#x7528;&#x6237;&#x5B9E;&#x4F8B;&#x6DFB;&#x52A0; <code>add/set/get Tasks</code> &#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x8BB0;&#x4F4F;&#xFF0C;&#x4F7F;&#x7528;<code>as</code>&#x6765;&#x66F4;&#x6539;&#x5173;&#x8054;&#x7684;&#x540D;&#x79F0;&#x4E5F;&#x4F1A;&#x6539;&#x53D8;&#x5916;&#x952E;&#x7684;&#x540D;&#x79F0;&#x3002; &#x5F53;&#x4F7F;&#x7528;<code>as</code>&#x65F6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x5916;&#x952E;&#x662F;&#x6700;&#x5B89;&#x5168;&#x7684;&#x3002;</p>
<pre><code class="lang-js">Invoice.belongsTo(Subscription)
Subscription.hasMany(Invoice)
</code></pre>
<p>&#x4E0D;&#x4F7F;&#x7528; <code>as</code>&#xFF0C;&#x8FD9;&#x4F1A;&#x6309;&#x9884;&#x671F;&#x6DFB;&#x52A0; <code>subscriptionId</code>&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x8981;&#x53D1;&#x9001;<code>Invoice.belongsTo(Subscription, { as: &apos;TheSubscription&apos; })</code>&#xFF0C;&#x90A3;&#x4E48;&#x60A8;&#x5C06;&#x540C;&#x65F6;&#x62E5;&#x6709; <code>subscriptionId</code> &#x548C; <code>theSubscriptionId</code>&#xFF0C;&#x56E0;&#x4E3A; sequelize &#x4E0D;&#x591F;&#x806A;&#x660E;&#xFF0C;&#x65E0;&#x6CD5;&#x786E;&#x5B9A;&#x8C03;&#x7528;&#x662F;&#x76F8;&#x540C;&#x5173;&#x7CFB;&#x7684;&#x4E24;&#x9762;&#x3002; <code>foreignKey</code> &#x4FEE;&#x6B63;&#x4E86;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;;</p>
<pre><code class="lang-js">Invoice.belongsTo(Subscription, { <span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;TheSubscription&apos;</span>, foreignKey: <span class="hljs-string">&apos;subscription_id&apos;</span> })
Subscription.hasMany(Invoice, { foreignKey: <span class="hljs-string">&apos;subscription_id&apos;</span> })
</code></pre>
<h2 id="&#x5173;&#x8054;&#x5BF9;&#x8C61;">&#x5173;&#x8054;&#x5BF9;&#x8C61;</h2>
<p>&#x56E0;&#x4E3A; Sequelize &#x505A;&#x4E86;&#x5F88;&#x591A;&#x795E;&#x5947;&#x7684;&#x4E8B;&#xFF0C;&#x6240;&#x4EE5;&#x4F60;&#x5FC5;&#x987B;&#x5728;&#x8BBE;&#x7F6E;&#x5173;&#x8054;&#x540E;&#x8C03;&#x7528; <code>Sequelize.sync</code>&#x3002; &#x8FD9;&#x6837;&#x505A;&#x5C06;&#x5141;&#x8BB8;&#x60A8;&#x8FDB;&#x884C;&#x4EE5;&#x4E0B;&#x64CD;&#x4F5C;&#xFF1A;</p>
<pre><code class="lang-js">Project.hasMany(Task)
Task.belongsTo(Project)

Project.create()...
Task.create()...
Task.create()...

<span class="hljs-comment">// &#x4FDD;&#x5B58;&#x5B83;&#x4EEC;.. &#x7136;&#x540E;:</span>
project.setTasks([task1, task2]).then(() =&gt; {
  <span class="hljs-comment">// &#x5DF2;&#x4FDD;&#x5B58;!</span>
})

<span class="hljs-comment">// &#x597D;&#x7684;&#xFF0C;&#x73B0;&#x5728;&#x5B83;&#x4EEC;&#x5DF2;&#x7ECF;&#x4FDD;&#x5B58;&#x4E86;...&#x6211;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x5F97;&#x5230;&#x4ED6;&#x4EEC;&#xFF1F;</span>
project.getTasks().then(associatedTasks =&gt; {
  <span class="hljs-comment">// associatedTasks &#x662F;&#x4E00;&#x4E2A; tasks &#x7684;&#x6570;&#x7EC4;</span>
})

<span class="hljs-comment">// &#x60A8;&#x8FD8;&#x53EF;&#x4EE5;&#x5C06;&#x8FC7;&#x6EE4;&#x5668;&#x4F20;&#x9012;&#x7ED9;getter&#x65B9;&#x6CD5;&#x3002;</span>
<span class="hljs-comment">// &#x5B83;&#x4EEC;&#x4E0E;&#x4F60;&#x80FD;&#x4F20;&#x9012;&#x7ED9;&#x5E38;&#x89C4;&#x67E5;&#x627E;&#x5668;&#x65B9;&#x6CD5;&#x7684;&#x9009;&#x9879;&#x76F8;&#x540C;&#x3002;</span>
project.getTasks({ where: <span class="hljs-string">&apos;id &gt; 10&apos;</span> }).then(tasks =&gt; {
  <span class="hljs-comment">// id&#x5927;&#x4E8E;10&#x7684;&#x4EFB;&#x52A1;</span>
})

<span class="hljs-comment">// &#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x4EC5;&#x68C0;&#x7D22;&#x5173;&#x8054;&#x5BF9;&#x8C61;&#x7684;&#x67D0;&#x4E9B;&#x5B57;&#x6BB5;&#x3002;</span>
project.getTasks({attributes: [<span class="hljs-string">&apos;title&apos;</span>]}).then(tasks =&gt; {
  <span class="hljs-comment">// &#x4F7F;&#x7528;&#x5C5E;&#x6027;&#x201C;title&#x201D;&#x548C;&#x201C;id&#x201D;&#x68C0;&#x7D22;&#x4EFB;&#x52A1;</span>
})
</code></pre>
<p>&#x8981;&#x5220;&#x9664;&#x521B;&#x5EFA;&#x7684;&#x5173;&#x8054;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x8C03;&#x7528;set&#x65B9;&#x6CD5;&#x800C;&#x4E0D;&#x4F7F;&#x7528;&#x7279;&#x5B9A;&#x7684;ID&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-comment">// &#x5220;&#x9664;&#x4E0E; task1 &#x7684;&#x5173;&#x8054;</span>
project.setTasks([task2]).then(associatedTasks =&gt; {
  <span class="hljs-comment">// &#x4F60;&#x5C06;&#x53EA;&#x5F97;&#x5230; task2</span>
})

<span class="hljs-comment">// &#x5220;&#x9664;&#x5168;&#x90E8;</span>
project.setTasks([]).then(associatedTasks =&gt; {
  <span class="hljs-comment">// &#x4F60;&#x5C06;&#x5F97;&#x5230;&#x7A7A;&#x6570;&#x7EC4;</span>
})

<span class="hljs-comment">// &#x6216;&#x66F4;&#x76F4;&#x63A5;&#x5730;&#x5220;&#x9664;</span>
project.removeTask(task1).then(() =&gt; {
  <span class="hljs-comment">// &#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x6709;</span>
})

<span class="hljs-comment">// &#x7136;&#x540E;&#x518D;&#x6B21;&#x6DFB;&#x52A0;&#x5B83;&#x4EEC;</span>
project.addTask(task1).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// &#x5B83;&#x4EEC;&#x53C8;&#x56DE;&#x6765;&#x4E86;</span>
})
</code></pre>
<p>&#x53CD;&#x4E4B;&#x4EA6;&#x7136;&#x4F60;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x505A;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-comment">// project&#x4E0E;task1&#x548C;task2&#x76F8;&#x5173;&#x8054;</span>
task2.setProject(<span class="hljs-literal">null</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// &#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x6709;</span>
})
</code></pre>
<p>&#x5BF9;&#x4E8E; hasOne/belongsTo &#x4E0E;&#x5176;&#x57FA;&#x672C;&#x76F8;&#x540C;:</p>
<pre><code class="lang-js">Task.hasOne(User, {<span class="hljs-keyword">as</span>: <span class="hljs-string">&quot;Author&quot;</span>})
Task.setAuthor(anAuthor)
</code></pre>
<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x6DFB;&#x52A0;&#x4E0E;&#x81EA;&#x5B9A;&#x4E49;&#x8FDE;&#x63A5;&#x8868;&#x7684;&#x5173;&#x7CFB;&#x7684;&#x5173;&#x8054;&#xFF08;&#x7EE7;&#x7EED;&#x524D;&#x4E00;&#x7AE0;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x5173;&#x8054;&#xFF09;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-comment">// &#x5728;&#x521B;&#x5EFA;&#x5173;&#x8054;&#x4E4B;&#x524D;&#xFF0C;&#x901A;&#x8FC7;&#x5411;&#x5BF9;&#x8C61;&#x6DFB;&#x52A0;&#x5177;&#x6709;&#x8FDE;&#x63A5;&#x8868;&#x6A21;&#x578B;&#x540D;&#x79F0;&#x7684;&#x5C5E;&#x6027;</span>
project.UserProjects = {
  status: <span class="hljs-string">&apos;active&apos;</span>
}
u.addProject(project)

<span class="hljs-comment">// &#x6216;&#x8005;&#x5728;&#x6DFB;&#x52A0;&#x5173;&#x8054;&#x65F6;&#x63D0;&#x4F9B;&#x7B2C;&#x4E8C;&#x4E2A;options.through&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x5E94;&#x8BE5;&#x5728;&#x8FDE;&#x63A5;&#x8868;&#x4E2D;&#x7684;&#x6570;&#x636E;</span>
u.addProject(project, { through: { status: <span class="hljs-string">&apos;active&apos;</span> }})


<span class="hljs-comment">// &#x5173;&#x8054;&#x591A;&#x4E2A;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x7EC4;&#x5408;&#x4E0A;&#x8FF0;&#x4E24;&#x4E2A;&#x9009;&#x9879;&#x3002; &#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;</span>
<span class="hljs-comment">// &#x5982;&#x679C;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x4F7F;&#x7528;&#x7684;&#x6570;&#x636E;&#x5C06;&#x88AB;&#x89C6;&#x4E3A;&#x9ED8;&#x8BA4;&#x5BF9;&#x8C61;</span>
project1.UserProjects = {
    status: <span class="hljs-string">&apos;inactive&apos;</span>
}

u.setProjects([project1, project2], { through: { status: <span class="hljs-string">&apos;active&apos;</span> }})
<span class="hljs-comment">// &#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x5C06;&#x5BF9;&#x9879;&#x76EE;1&#x8BB0;&#x5F55;&#x65E0;&#x6548;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x8FDE;&#x63A5;&#x8868;&#x4E2D;&#x5BF9;&#x9879;&#x76EE;2&#x8FDB;&#x884C;active</span>
</code></pre>
<p>&#x5F53;&#x83B7;&#x53D6;&#x5177;&#x6709;&#x81EA;&#x5B9A;&#x4E49;&#x8FDE;&#x63A5;&#x8868;&#x7684;&#x5173;&#x8054;&#x7684;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x8FDE;&#x63A5;&#x8868;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5C06;&#x4F5C;&#x4E3A;DAO&#x5B9E;&#x4F8B;&#x8FD4;&#x56DE;&#xFF1A;</p>
<pre><code class="lang-js">u.getProjects().then(projects =&gt; {
  <span class="hljs-keyword">const</span> project = projects[<span class="hljs-number">0</span>]

  <span class="hljs-keyword">if</span> (project.UserProjects.status === <span class="hljs-string">&apos;active&apos;</span>) {
    <span class="hljs-comment">// .. &#x505A;&#x70B9;&#x4EC0;&#x4E48;</span>

    <span class="hljs-comment">// &#x7531;&#x4E8E;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x771F;&#x6B63;&#x7684;DAO&#x5B9E;&#x4F8B;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5728;&#x5B8C;&#x6210;&#x64CD;&#x4F5C;&#x4E4B;&#x540E;&#x76F4;&#x63A5;&#x4FDD;&#x5B58;&#x5B83;</span>
    <span class="hljs-keyword">return</span> project.UserProjects.save()
  }
})
</code></pre>
<p>&#x5982;&#x679C;&#x60A8;&#x4EC5;&#x9700;&#x8981;&#x8FDE;&#x63A5;&#x8868;&#x4E2D;&#x7684;&#x67D0;&#x4E9B;&#x5C5E;&#x6027;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x5177;&#x6709;&#x6240;&#x9700;&#x5C5E;&#x6027;&#x7684;&#x6570;&#x7EC4;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-comment">// &#x8FD9;&#x5C06;&#x4EC5;&#x4ECE; Projects &#x8868;&#x4E2D;&#x9009;&#x62E9; name&#xFF0C;&#x4EC5;&#x4ECE; UserProjects &#x8868;&#x4E2D;&#x9009;&#x62E9;status</span>
user.getProjects({ attributes: [<span class="hljs-string">&apos;name&apos;</span>], joinTableAttributes: [<span class="hljs-string">&apos;status&apos;</span>]})
</code></pre>
<h2 id="&#x68C0;&#x67E5;&#x5173;&#x8054;">&#x68C0;&#x67E5;&#x5173;&#x8054;</h2>
<p>&#x60A8;&#x8FD8;&#x53EF;&#x4EE5;&#x68C0;&#x67E5;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x4E0E;&#x53E6;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x76F8;&#x5173;&#x8054;&#xFF08;&#x4EC5; n:m&#xFF09;&#x3002; &#x8FD9;&#x662F;&#x4F60;&#x600E;&#x4E48;&#x505A;&#x7684;</p>
<pre><code class="lang-js"><span class="hljs-comment">// &#x68C0;&#x67E5;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x662F;&#x5173;&#x8054;&#x5BF9;&#x8C61;&#x4E4B;&#x4E00;&#xFF1A;</span>
Project.create({ <span class="hljs-comment">/* */</span> }).then(project =&gt; {
  <span class="hljs-keyword">return</span> User.create({ <span class="hljs-comment">/* */</span> }).then(user =&gt; {
    <span class="hljs-keyword">return</span> project.hasUser(user).then(result =&gt; {
      <span class="hljs-comment">// &#x7ED3;&#x679C;&#x662F; false</span>
      <span class="hljs-keyword">return</span> project.addUser(user).then(() =&gt; {
        <span class="hljs-keyword">return</span> project.hasUser(user).then(result =&gt; {
          <span class="hljs-comment">// &#x7ED3;&#x679C;&#x662F; true</span>
        })
      })
    })
  })
})

<span class="hljs-comment">// &#x68C0;&#x67E5;&#x6240;&#x6709;&#x5173;&#x8054;&#x7684;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x5982;&#x9884;&#x671F;&#x7684;&#x90A3;&#x6837;&#xFF1A;</span>
<span class="hljs-comment">// &#x6211;&#x4EEC;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x6709;&#x4E00;&#x4E2A;&#x9879;&#x76EE;&#x548C;&#x4E24;&#x4E2A;&#x7528;&#x6237;</span>
project.setUsers([user1, user2]).then(() =&gt; {
  <span class="hljs-keyword">return</span> project.hasUsers([user1]);
}).then(result =&gt; {
  <span class="hljs-comment">// &#x7ED3;&#x679C;&#x662F; true</span>
  <span class="hljs-keyword">return</span> project.hasUsers([user1, user2]);
}).then(result =&gt; {
  <span class="hljs-comment">// &#x7ED3;&#x679C;&#x662F; true</span>
})
</code></pre>
<h2 id="&#x9AD8;&#x7EA7;&#x6982;&#x5FF5;">&#x9AD8;&#x7EA7;&#x6982;&#x5FF5;</h2>
<h3 id="&#x4F5C;&#x7528;&#x57DF;">&#x4F5C;&#x7528;&#x57DF;</h3>
<p>&#x672C;&#x8282;&#x6D89;&#x53CA;&#x5173;&#x8054;&#x4F5C;&#x7528;&#x57DF;&#x3002; &#x6709;&#x5173;&#x5173;&#x8054;&#x4F5C;&#x7528;&#x57DF;&#x4E0E;&#x76F8;&#x5173;&#x6A21;&#x578B;&#x4E0A;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x7684;&#x5B9A;&#x4E49;&#xFF0C;&#x8BF7;&#x53C2;&#x9605; <a href="scopes.html">&#x4F5C;&#x7528;&#x57DF;</a>&#x3002;</p>
<p>&#x5173;&#x8054;&#x4F5C;&#x7528;&#x57DF;&#x5141;&#x8BB8;&#x60A8;&#x5728;&#x5173;&#x8054;&#x4E0A;&#x653E;&#x7F6E;&#x4E00;&#x4E2A;&#x4F5C;&#x7528;&#x57DF;(&#x4E00;&#x5957; <code>get</code> &#x548C; <code>create</code> &#x7684;&#x9ED8;&#x8BA4;&#x5C5E;&#x6027;)&#x3002;&#x4F5C;&#x7528;&#x57DF;&#x53EF;&#x4EE5;&#x653E;&#x5728;&#x76F8;&#x5173;&#x8054;&#x7684;&#x6A21;&#x578B;&#xFF08;&#x5173;&#x8054;&#x7684;target&#xFF09;&#x4E0A;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8868;&#x4E0A;&#x7684; n:m &#x5173;&#x7CFB;&#x3002;</p>
<h4 id="1n">1:n</h4>
<p>&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x6709;&#x6A21;&#x578B; Comment&#xFF0C;Post &#x548C; Image&#x3002; &#x4E00;&#x4E2A;&#x8BC4;&#x8BBA;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>commentableId</code> &#x548C; <code>commentable</code> &#x5173;&#x8054;&#x5230;&#x4E00;&#x4E2A;&#x56FE;&#x50CF;&#x6216;&#x4E00;&#x4E2A;&#x5E16;&#x5B50; - &#x6211;&#x4EEC;&#x8BF4; Post &#x548C; Image &#x662F; <code>Commentable</code></p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> Post = sequelize.define(<span class="hljs-string">&apos;post&apos;</span>, {
  title: Sequelize.STRING,
  text: Sequelize.STRING
});

<span class="hljs-keyword">const</span> Image = sequelize.define(<span class="hljs-string">&apos;image&apos;</span>, {
  title: Sequelize.STRING,
  link: Sequelize.STRING
});

<span class="hljs-keyword">const</span> Comment = sequelize.define(<span class="hljs-string">&apos;comment&apos;</span>, {
  title: Sequelize.STRING,
  commentable: Sequelize.STRING,
  commentableId: Sequelize.INTEGER
});

Comment.prototype.getItem = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>[
    <span class="hljs-string">&apos;get&apos;</span> +
      <span class="hljs-keyword">this</span>.get(<span class="hljs-string">&apos;commentable&apos;</span>)
        .substr(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)
        .toUpperCase() +
      <span class="hljs-keyword">this</span>.get(<span class="hljs-string">&apos;commentable&apos;</span>).substr(<span class="hljs-number">1</span>)
  ](options);
};

Post.hasMany(Comment, {
  foreignKey: <span class="hljs-string">&apos;commentableId&apos;</span>,
  constraints: <span class="hljs-literal">false</span>,
  scope: {
    commentable: <span class="hljs-string">&apos;post&apos;</span>
  }
});

Comment.belongsTo(Post, {
  foreignKey: <span class="hljs-string">&apos;commentableId&apos;</span>,
  constraints: <span class="hljs-literal">false</span>,
  <span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;post&apos;</span>
});

Image.hasMany(Comment, {
  foreignKey: <span class="hljs-string">&apos;commentableId&apos;</span>,
  constraints: <span class="hljs-literal">false</span>,
  scope: {
    commentable: <span class="hljs-string">&apos;image&apos;</span>
  }
});

Comment.belongsTo(Image, {
  foreignKey: <span class="hljs-string">&apos;commentableId&apos;</span>,
  constraints: <span class="hljs-literal">false</span>,
  <span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;image&apos;</span>
});
</code></pre>
<p><code>constraints: false</code> &#x7981;&#x7528;&#x4E86;&#x5F15;&#x7528;&#x7EA6;&#x675F;&#xFF0C;&#x56E0;&#x4E3A; <code>commentable_id</code> &#x5217;&#x5F15;&#x7528;&#x4E86;&#x591A;&#x4E2A;&#x8868;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x7ED9;&#x5B83;&#x6DFB;&#x52A0; <code>REFERENCES</code> &#x7EA6;&#x675F;&#x3002;</p>
<p>&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;Image - &gt; Comment &#x548C; Post - &gt; Comment &#x5173;&#x7CFB;&#x5206;&#x522B;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x4F5C;&#x7528;&#x57DF;&#xFF1A;<code>commentable: &apos;image&apos;</code>  &#x548C;  <code>commentable: &apos;post&apos;</code>&#x3002; &#x4F7F;&#x7528;&#x5173;&#x8054;&#x529F;&#x80FD;&#x65F6;&#x81EA;&#x52A8;&#x5E94;&#x7528;&#x6B64;&#x4F5C;&#x7528;&#x57DF;&#xFF1A;</p>
<pre><code class="lang-js">image.getComments()
<span class="hljs-comment">// SELECT &quot;id&quot;, &quot;title&quot;, &quot;commentable&quot;, &quot;commentableId&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;comments&quot; AS &quot;comment&quot; WHERE &quot;comment&quot;.&quot;commentable&quot; = &apos;image&apos; AND &quot;comment&quot;.&quot;commentableId&quot; = 1;</span>

image.createComment({
  title: <span class="hljs-string">&apos;Awesome!&apos;</span>
})
<span class="hljs-comment">// INSERT INTO &quot;comments&quot; (&quot;id&quot;,&quot;title&quot;,&quot;commentable&quot;,&quot;commentableId&quot;,&quot;createdAt&quot;,&quot;updatedAt&quot;) VALUES (DEFAULT,&apos;Awesome!&apos;,&apos;image&apos;,1,&apos;2018-04-17 05:36:40.454 +00:00&apos;,&apos;2018-04-17 05:36:40.454 +00:00&apos;) RETURNING *;</span>

image.addComment(comment);
<span class="hljs-comment">// UPDATE &quot;comments&quot; SET &quot;commentableId&quot;=1,&quot;commentable&quot;=&apos;image&apos;,&quot;updatedAt&quot;=&apos;2018-04-17 05:38:43.948 +00:00&apos; WHERE &quot;id&quot; IN (1)</span>
</code></pre>
<p><code>Comment</code> &#x4E0A;&#x7684; <code>getItem</code> &#x4F5C;&#x7528;&#x51FD;&#x6570;&#x5B8C;&#x6210;&#x4E86;&#x56FE;&#x7247; - &#x5B83;&#x53EA;&#x662F;&#x5C06; <code>commentable</code> &#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x4E3A; <code>getImage</code> &#x6216; <code>getPost</code> &#x7684;&#x4E00;&#x4E2A;&#x8C03;&#x7528;&#xFF0C;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x6CE8;&#x91CA;&#x662F;&#x5C5E;&#x4E8E;&#x4E00;&#x4E2A;&#x5E16;&#x5B50;&#x8FD8;&#x662F;&#x4E00;&#x4E2A;&#x56FE;&#x50CF;&#x7684;&#x62BD;&#x8C61;&#x6982;&#x5FF5;&#x3002;&#x60A8;&#x53EF;&#x4EE5;&#x5C06;&#x666E;&#x901A;&#x9009;&#x9879;&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7ED9; <code>getItem(options)</code>&#xFF0C;&#x4EE5;&#x6307;&#x5B9A;&#x4EFB;&#x4F55;&#x6761;&#x4EF6;&#x6216;&#x5305;&#x542B;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>
<h4 id="nm">n:m</h4>
<p>&#x7EE7;&#x7EED;&#x591A;&#x6001;&#x6A21;&#x578B;&#x7684;&#x601D;&#x8DEF;&#xFF0C;&#x8003;&#x8651;&#x4E00;&#x4E2A; tag &#x8868; - &#x4E00;&#x4E2A; item &#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A; tag&#xFF0C;&#x4E00;&#x4E2A; tag &#x53EF;&#x4EE5;&#x4E0E;&#x591A;&#x4E2A; item &#x76F8;&#x5173;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x7B80;&#x6D01;&#x8D77;&#x89C1;&#xFF0C;&#x8BE5;&#x793A;&#x4F8B;&#x4EC5;&#x663E;&#x793A;&#x4E86; Post &#x6A21;&#x578B;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x4E0A; Tag &#x4E0E;&#x5176;&#x4ED6;&#x51E0;&#x4E2A;&#x6A21;&#x578B;&#x76F8;&#x5173;&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> ItemTag = sequelize.define(<span class="hljs-string">&apos;item_tag&apos;</span>, {
  id: {
    type: Sequelize.INTEGER,
    primaryKey: <span class="hljs-literal">true</span>,
    autoIncrement: <span class="hljs-literal">true</span>
  },
  tagId: {
    type: Sequelize.INTEGER,
    unique: <span class="hljs-string">&apos;item_tag_taggable&apos;</span>
  },
  taggable: {
    type: Sequelize.STRING,
    unique: <span class="hljs-string">&apos;item_tag_taggable&apos;</span>
  },
  taggableId: {
    type: Sequelize.INTEGER,
    unique: <span class="hljs-string">&apos;item_tag_taggable&apos;</span>,
    references: <span class="hljs-literal">null</span>
  }
});

<span class="hljs-keyword">const</span> Tag = sequelize.define(<span class="hljs-string">&apos;tag&apos;</span>, {
  name: Sequelize.STRING,
  status: Sequelize.STRING
});

Post.belongsToMany(Tag, {
  through: {
    model: ItemTag,
    unique: <span class="hljs-literal">false</span>,
    scope: {
      taggable: <span class="hljs-string">&apos;post&apos;</span>
    }
  },
  foreignKey: <span class="hljs-string">&apos;taggableId&apos;</span>,
  constraints: <span class="hljs-literal">false</span>
});

Tag.belongsToMany(Post, {
  through: {
    model: ItemTag,
    unique: <span class="hljs-literal">false</span>
  },
  foreignKey: <span class="hljs-string">&apos;tagId&apos;</span>,
  constraints: <span class="hljs-literal">false</span>
});
</code></pre>
<p>&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x4F5C;&#x7528;&#x57DF;&#x5217;&#xFF08;<code>taggable</code>&#xFF09;&#x73B0;&#x5728;&#x5728; through &#x6A21;&#x578B;&#xFF08;<code>ItemTag</code>&#xFF09;&#x4E0A;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x66F4;&#x5177;&#x9650;&#x5236;&#x6027;&#x7684;&#x5173;&#x8054;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x901A;&#x8FC7;&#x5E94;&#x7528;through &#x6A21;&#x578B;&#xFF08;<code>ItemTag</code>&#xFF09;&#x548C;&#x76EE;&#x6807;&#x6A21;&#x578B;&#xFF08;<code>Tag</code>&#xFF09;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x6765;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x6302;&#x8D77;&#x7684; tag&#x3002;</p>
<pre><code class="lang-js">Post.belongsToMany(Tag, {
  through: {
    model: ItemTag,
    unique: <span class="hljs-literal">false</span>,
    scope: {
      taggable: <span class="hljs-string">&apos;post&apos;</span>
    }
  },
  scope: {
    status: <span class="hljs-string">&apos;pending&apos;</span>
  },
  <span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;pendingTags&apos;</span>,
  foreignKey: <span class="hljs-string">&apos;taggableId&apos;</span>,
  constraints: <span class="hljs-literal">false</span>
});

post.getPendingTags();
</code></pre>
<pre><code class="lang-sql"><span class="hljs-keyword">SELECT</span>
  <span class="hljs-string">&quot;tag&quot;</span>.<span class="hljs-string">&quot;id&quot;</span>,
  <span class="hljs-string">&quot;tag&quot;</span>.<span class="hljs-string">&quot;name&quot;</span>,
  <span class="hljs-string">&quot;tag&quot;</span>.<span class="hljs-string">&quot;status&quot;</span>,
  <span class="hljs-string">&quot;tag&quot;</span>.<span class="hljs-string">&quot;createdAt&quot;</span>,
  <span class="hljs-string">&quot;tag&quot;</span>.<span class="hljs-string">&quot;updatedAt&quot;</span>,
  <span class="hljs-string">&quot;item_tag&quot;</span>.<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-keyword">AS</span> <span class="hljs-string">&quot;item_tag.id&quot;</span>,
  <span class="hljs-string">&quot;item_tag&quot;</span>.<span class="hljs-string">&quot;tagId&quot;</span> <span class="hljs-keyword">AS</span> <span class="hljs-string">&quot;item_tag.tagId&quot;</span>,
  <span class="hljs-string">&quot;item_tag&quot;</span>.<span class="hljs-string">&quot;taggable&quot;</span> <span class="hljs-keyword">AS</span> <span class="hljs-string">&quot;item_tag.taggable&quot;</span>,
  <span class="hljs-string">&quot;item_tag&quot;</span>.<span class="hljs-string">&quot;taggableId&quot;</span> <span class="hljs-keyword">AS</span> <span class="hljs-string">&quot;item_tag.taggableId&quot;</span>,
  <span class="hljs-string">&quot;item_tag&quot;</span>.<span class="hljs-string">&quot;createdAt&quot;</span> <span class="hljs-keyword">AS</span> <span class="hljs-string">&quot;item_tag.createdAt&quot;</span>,
  <span class="hljs-string">&quot;item_tag&quot;</span>.<span class="hljs-string">&quot;updatedAt&quot;</span> <span class="hljs-keyword">AS</span> <span class="hljs-string">&quot;item_tag.updatedAt&quot;</span>
<span class="hljs-keyword">FROM</span>
  <span class="hljs-string">&quot;tags&quot;</span> <span class="hljs-keyword">AS</span> <span class="hljs-string">&quot;tag&quot;</span>
  <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-string">&quot;item_tags&quot;</span> <span class="hljs-keyword">AS</span> <span class="hljs-string">&quot;item_tag&quot;</span> <span class="hljs-keyword">ON</span> <span class="hljs-string">&quot;tag&quot;</span>.<span class="hljs-string">&quot;id&quot;</span> = <span class="hljs-string">&quot;item_tag&quot;</span>.<span class="hljs-string">&quot;tagId&quot;</span>
  <span class="hljs-keyword">AND</span> <span class="hljs-string">&quot;item_tag&quot;</span>.<span class="hljs-string">&quot;taggableId&quot;</span> = <span class="hljs-number">1</span>
  <span class="hljs-keyword">AND</span> <span class="hljs-string">&quot;item_tag&quot;</span>.<span class="hljs-string">&quot;taggable&quot;</span> = <span class="hljs-string">&apos;post&apos;</span>
<span class="hljs-keyword">WHERE</span>
  (<span class="hljs-string">&quot;tag&quot;</span>.<span class="hljs-string">&quot;status&quot;</span> = <span class="hljs-string">&apos;pending&apos;</span>);
</code></pre>
<p><code>constraints: false</code> &#x7981;&#x7528; <code>taggableId</code> &#x5217;&#x4E0A;&#x7684;&#x5F15;&#x7528;&#x7EA6;&#x675F;&#x3002; &#x56E0;&#x4E3A;&#x5217;&#x662F;&#x591A;&#x6001;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x8BF4;&#x5B83;&#x662F; <code>REFERENCES</code> &#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x8868;&#x3002;</p>
<h3 id="&#x7528;&#x5173;&#x8054;&#x521B;&#x5EFA;">&#x7528;&#x5173;&#x8054;&#x521B;&#x5EFA;</h3>
<p>&#x5982;&#x679C;&#x6240;&#x6709;&#x5143;&#x7D20;&#x90FD;&#x662F;&#x65B0;&#x7684;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5728;&#x4E00;&#x4E2A;&#x6B65;&#x9AA4;&#x4E2D;&#x521B;&#x5EFA;&#x5177;&#x6709;&#x5D4C;&#x5957;&#x5173;&#x8054;&#x7684;&#x5B9E;&#x4F8B;&#x3002;</p>
<h4 id="belongsto--hasmany--hasone-&#x5173;&#x8054;">BelongsTo / HasMany / HasOne &#x5173;&#x8054;</h4>
<p>&#x8003;&#x8651;&#x4EE5;&#x4E0B;&#x6A21;&#x578B;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> Product = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;product&apos;</span>, {
  title: Sequelize.STRING
});
<span class="hljs-keyword">const</span> User = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;user&apos;</span>, {
  firstName: Sequelize.STRING,
  lastName: Sequelize.STRING
});
<span class="hljs-keyword">const</span> Address = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;address&apos;</span>, {
  type: Sequelize.STRING,
  line1: Sequelize.STRING,
  line2: Sequelize.STRING,
  city: Sequelize.STRING,
  state: Sequelize.STRING,
  zip: Sequelize.STRING,
});

Product.User = Product.belongsTo(User);
User.Addresses = User.hasMany(Address);
<span class="hljs-comment">// &#x4E5F;&#x80FD;&#x7528;&#x4E8E; `hasOne`</span>
</code></pre>
<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x65B9;&#x5F0F;&#x5728;&#x4E00;&#x4E2A;&#x6B65;&#x9AA4;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;<code>Product</code>, <code>User</code>&#x548C;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;<code>Address</code>: </p>
<pre><code class="lang-js"><span class="hljs-keyword">return</span> Product.create({
  title: <span class="hljs-string">&apos;Chair&apos;</span>,
  user: {
    firstName: <span class="hljs-string">&apos;Mick&apos;</span>,
    lastName: <span class="hljs-string">&apos;Broadstone&apos;</span>,
    addresses: [{
      type: <span class="hljs-string">&apos;home&apos;</span>,
      line1: <span class="hljs-string">&apos;100 Main St.&apos;</span>,
      city: <span class="hljs-string">&apos;Austin&apos;</span>,
      state: <span class="hljs-string">&apos;TX&apos;</span>,
      zip: <span class="hljs-string">&apos;78704&apos;</span>
    }]
  }
}, {
  include: [{
    association: Product.User,
    include: [ User.Addresses ]
  }]
});
</code></pre>
<p>&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x7528;&#x6237;&#x6A21;&#x578B;&#x79F0;&#x4E3A;<code>user</code>&#xFF0C;&#x5E26;&#x5C0F;&#x5199;u - &#x8FD9;&#x610F;&#x5473;&#x7740;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x5C5E;&#x6027;&#x4E5F;&#x5E94;&#x8BE5;&#x662F;<code>user</code>&#x3002; &#x5982;&#x679C;&#x7ED9;<code>sequelize.define</code>&#x6307;&#x5B9A;&#x7684;&#x540D;&#x79F0;&#x4E3A;<code>User</code>&#xFF0C;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x952E;&#x4E5F;&#x5E94;&#x4E3A;<code>User</code>&#x3002; &#x5BF9;&#x4E8E;<code>addresses</code>&#x4E5F;&#x662F;&#x540C;&#x6837;&#x7684;&#xFF0C;&#x9664;&#x4E86;&#x5B83;&#x662F;&#x4E00;&#x4E2A; <code>hasMany</code> &#x5173;&#x8054;&#x7684;&#x590D;&#x6570;&#x3002;</p>
<h4 id="&#x7528;&#x522B;&#x540D;&#x521B;&#x5EFA;-belongsto-&#x5173;&#x8054;">&#x7528;&#x522B;&#x540D;&#x521B;&#x5EFA; BelongsTo &#x5173;&#x8054;</h4>
<p>&#x53EF;&#x4EE5;&#x5C06;&#x524D;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x6269;&#x5C55;&#x4E3A;&#x652F;&#x6301;&#x5173;&#x8054;&#x522B;&#x540D;&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> Creator = Product.belongsTo(User, { <span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;creator&apos;</span> });

<span class="hljs-keyword">return</span> Product.create({
  title: <span class="hljs-string">&apos;Chair&apos;</span>,
  creator: {
    firstName: <span class="hljs-string">&apos;Matt&apos;</span>,
    lastName: <span class="hljs-string">&apos;Hansen&apos;</span>
  }
}, {
  include: [ Creator ]
});
</code></pre>
<h4 id="hasmany--belongstomany-&#x5173;&#x8054;">HasMany / BelongsToMany &#x5173;&#x8054;</h4>
<p>&#x6211;&#x4EEC;&#x6765;&#x4ECB;&#x7ECD;&#x5C06;&#x4EA7;&#x54C1;&#x4E0E;&#x8BB8;&#x591A;&#x6807;&#x7B7E;&#x76F8;&#x5173;&#x8054;&#x7684;&#x529F;&#x80FD;&#x3002; &#x8BBE;&#x7F6E;&#x6A21;&#x578B;&#x53EF;&#x80FD;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> Tag = <span class="hljs-keyword">this</span>.sequelize.define(<span class="hljs-string">&apos;tag&apos;</span>, {
  name: Sequelize.STRING
});

Product.hasMany(Tag);
<span class="hljs-comment">// Also works for `belongsToMany`.</span>
</code></pre>
<p>&#x73B0;&#x5728;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x65B9;&#x5F0F;&#x521B;&#x5EFA;&#x5177;&#x6709;&#x591A;&#x4E2A;&#x6807;&#x7B7E;&#x7684;&#x4EA7;&#x54C1;&#xFF1A;</p>
<pre><code class="lang-js">Product.create({
  id: <span class="hljs-number">1</span>,
  title: <span class="hljs-string">&apos;Chair&apos;</span>,
  tags: [
    { name: <span class="hljs-string">&apos;Alpha&apos;</span>},
    { name: <span class="hljs-string">&apos;Beta&apos;</span>}
  ]
}, {
  include: [ Tag ]
})
</code></pre>
<p>&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x6B64;&#x793A;&#x4F8B;&#x4EE5;&#x652F;&#x6301;&#x522B;&#x540D;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> Categories = Product.hasMany(Tag, { <span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;categories&apos;</span> });

Product.create({
  id: <span class="hljs-number">1</span>,
  title: <span class="hljs-string">&apos;Chair&apos;</span>,
  categories: [
    { id: <span class="hljs-number">1</span>, name: <span class="hljs-string">&apos;Alpha&apos;</span> },
    { id: <span class="hljs-number">2</span>, name: <span class="hljs-string">&apos;Beta&apos;</span> }
  ]
}, {
  include: [{
    model: Categories,
    <span class="hljs-keyword">as</span>: <span class="hljs-string">&apos;categories&apos;</span>
  }]
})
</code></pre>
<hr>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="usage.html" class="navigation navigation-prev " aria-label="Previous page: 快速上手">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="hooks.html" class="navigation navigation-next " aria-label="Next page: 生命周期Hook">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"类型关联","level":"1.4","depth":1,"next":{"title":"生命周期Hook","level":"1.5","depth":1,"path":"book/hooks.md","ref":"book/hooks.md","articles":[]},"previous":{"title":"快速上手","level":"1.3","depth":1,"path":"book/usage.md","ref":"book/usage.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"book/associations.md","mtime":"2019-01-14T11:58:43.910Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-01-14T15:58:44.077Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

